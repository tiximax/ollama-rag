{
  "dashboard": {
    "title": "üöÄ Ollama RAG Production Dashboard",
    "description": "Real-time monitoring for Ollama RAG performance, health, and metrics",
    "tags": ["ollama", "rag", "llm", "monitoring"],
    "timezone": "browser",
    "schemaVersion": 30,
    "version": 1,
    "refresh": "10s",
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "panels": [
      {
        "id": 1,
        "title": "üìä Query Rate (req/s)",
        "type": "graph",
        "gridPos": {"x": 0, "y": 0, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "rate(ollama_rag_queries_total[5m])",
            "legendFormat": "{{method}} - {{provider}}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {"format": "reqps", "label": "Queries/sec"},
          {"format": "short"}
        ],
        "tooltip": {"shared": true, "sort": 2}
      },
      {
        "id": 2,
        "title": "‚è±Ô∏è Response Time (P50, P95, P99)",
        "type": "graph",
        "gridPos": {"x": 12, "y": 0, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "histogram_quantile(0.50, rate(ollama_rag_llm_response_seconds_bucket[5m]))",
            "legendFormat": "P50",
            "refId": "A"
          },
          {
            "expr": "histogram_quantile(0.95, rate(ollama_rag_llm_response_seconds_bucket[5m]))",
            "legendFormat": "P95",
            "refId": "B"
          },
          {
            "expr": "histogram_quantile(0.99, rate(ollama_rag_llm_response_seconds_bucket[5m]))",
            "legendFormat": "P99",
            "refId": "C"
          }
        ],
        "yaxes": [
          {"format": "s", "label": "Response Time"},
          {"format": "short"}
        ],
        "tooltip": {"shared": true, "sort": 2},
        "alert": {
          "name": "High Response Time",
          "conditions": [
            {
              "evaluator": {"params": [30], "type": "gt"},
              "query": {"params": ["C", "5m", "now"]},
              "type": "query"
            }
          ]
        }
      },
      {
        "id": 3,
        "title": "üéØ Cache Hit Rate (%)",
        "type": "stat",
        "gridPos": {"x": 0, "y": 8, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "(sum(rate(ollama_rag_cache_hits_total[5m])) / (sum(rate(ollama_rag_cache_hits_total[5m])) + sum(rate(ollama_rag_cache_misses_total[5m])))) * 100",
            "refId": "A"
          }
        ],
        "options": {
          "graphMode": "area",
          "colorMode": "value",
          "textMode": "value_and_name"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 30, "color": "yellow"},
                {"value": 70, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "title": "‚ù§Ô∏è Service Health",
        "type": "stat",
        "gridPos": {"x": 6, "y": 8, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "up{job=\"ollama_rag\"}",
            "refId": "A"
          }
        ],
        "options": {
          "graphMode": "none",
          "colorMode": "background",
          "textMode": "name"
        },
        "fieldConfig": {
          "defaults": {
            "mappings": [
              {"type": "value", "options": {"0": {"text": "DOWN ‚ùå", "color": "red"}}},
              {"type": "value", "options": {"1": {"text": "UP ‚úÖ", "color": "green"}}}
            ]
          }
        }
      },
      {
        "id": 5,
        "title": "üíæ Database Size (GB)",
        "type": "stat",
        "gridPos": {"x": 12, "y": 8, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "ollama_rag_db_size_bytes / 1e9",
            "refId": "A"
          }
        ],
        "options": {
          "graphMode": "area",
          "colorMode": "value"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "decgbytes",
            "decimals": 2
          }
        }
      },
      {
        "id": 6,
        "title": "üî• Error Rate",
        "type": "stat",
        "gridPos": {"x": 18, "y": 8, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "rate(ollama_rag_query_errors_total[5m])",
            "refId": "A"
          }
        ],
        "options": {
          "graphMode": "area",
          "colorMode": "value"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percentunit",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 0.01, "color": "yellow"},
                {"value": 0.1, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 7,
        "title": "üìà Queries by Method",
        "type": "piechart",
        "gridPos": {"x": 0, "y": 12, "w": 8, "h": 8},
        "targets": [
          {
            "expr": "sum by (method) (rate(ollama_rag_queries_total[5m]))",
            "legendFormat": "{{method}}",
            "refId": "A"
          }
        ],
        "options": {
          "legend": {"displayMode": "table", "placement": "right"},
          "pieType": "donut"
        }
      },
      {
        "id": 8,
        "title": "ü§ñ Queries by Provider",
        "type": "piechart",
        "gridPos": {"x": 8, "y": 12, "w": 8, "h": 8},
        "targets": [
          {
            "expr": "sum by (provider) (rate(ollama_rag_queries_total[5m]))",
            "legendFormat": "{{provider}}",
            "refId": "A"
          }
        ],
        "options": {
          "legend": {"displayMode": "table", "placement": "right"},
          "pieType": "donut"
        }
      },
      {
        "id": 9,
        "title": "üí¨ Active Chats",
        "type": "stat",
        "gridPos": {"x": 16, "y": 12, "w": 8, "h": 8},
        "targets": [
          {
            "expr": "ollama_rag_active_chats",
            "refId": "A"
          }
        ],
        "options": {
          "graphMode": "area",
          "colorMode": "value"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "short"
          }
        }
      },
      {
        "id": 10,
        "title": "üéØ Retrieval Performance",
        "type": "graph",
        "gridPos": {"x": 0, "y": 20, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "histogram_quantile(0.90, rate(ollama_rag_retrieval_seconds_bucket[5m]))",
            "legendFormat": "P90 Retrieval",
            "refId": "A"
          },
          {
            "expr": "histogram_quantile(0.90, rate(ollama_rag_rerank_seconds_bucket[5m]))",
            "legendFormat": "P90 Reranking",
            "refId": "B"
          }
        ],
        "yaxes": [
          {"format": "s", "label": "Time"},
          {"format": "short"}
        ]
      },
      {
        "id": 11,
        "title": "üíª System Resources",
        "type": "graph",
        "gridPos": {"x": 12, "y": 20, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "ollama_rag_system_cpu_percent",
            "legendFormat": "CPU %",
            "refId": "A"
          },
          {
            "expr": "ollama_rag_system_memory_percent",
            "legendFormat": "Memory %",
            "refId": "B"
          }
        ],
        "yaxes": [
          {"format": "percent", "max": 100, "min": 0},
          {"format": "short"}
        ]
      },
      {
        "id": 12,
        "title": "üìä HTTP Requests by Status",
        "type": "graph",
        "gridPos": {"x": 0, "y": 28, "w": 24, "h": 8},
        "targets": [
          {
            "expr": "rate(http_requests_total{job=\"ollama_rag\"}[5m])",
            "legendFormat": "{{status}} - {{method}}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {"format": "reqps"},
          {"format": "short"}
        ]
      }
    ]
  },
  "overwrite": true,
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "description": "Prometheus data source",
      "type": "datasource",
      "pluginId": "prometheus"
    }
  ],
  "__requires": [
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "8.0.0"
    },
    {
      "type": "datasource",
      "id": "prometheus",
      "name": "Prometheus",
      "version": "1.0.0"
    }
  ]
}
