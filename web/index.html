<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ollama RAG App</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <link rel="icon" href="/static/favicon.ico" />
  </head>
  <body>
    <div class="ui-root">
      <div class="menubar">
        <span class="menu-item" id="menu-file">File</span>
        <span class="menu-item" id="menu-settings">C√†i ƒë·∫∑t</span>
        <span class="menu-item" id="menu-help">H·ªó tr·ª£</span>
      </div>
      <!-- Top action bar -->
      <div class="topbar">
        <div class="left">
          <span class="label">Vector DB:</span>
<select id="db-select" class="control" title="Ch·ªçn c∆° s·ªü d·ªØ li·ªáu (Vector DB)"></select>
<input id="db-new-name" class="control" type="text" placeholder="T√™n DB m·ªõi" title="Nh·∫≠p t√™n DB (ch·ªâ ch·ªØ/s·ªë/._-)" />
<button id="btn-db-create" class="btn" title="T·∫°o DB m·ªõi">DB m·ªõi</button>
<button id="btn-db-delete" class="btn danger" title="X√≥a DB hi·ªán t·∫°i (kh√¥ng th·ªÉ ho√†n t√°c)">X√≥a DB</button>
        </div>
        <div class="right">
<input id="ingest-paths" class="control wide" type="text" placeholder="ƒê∆∞·ªùng d·∫´n ho·∫∑c URL (v√≠ d·ª• data/docs/*.txt)" title="H·ªó tr·ª£ pattern *.txt, ph√¢n t√°ch b·∫±ng d·∫•u ph·∫©y, ho·∫∑c nh·∫≠p URL" />
<button id="btn-ingest-paths" class="btn" title="Th√™m t√†i li·ªáu t·ª´ ƒë∆∞·ªùng d·∫´n/URL v√†o DB">Th√™m v√†o DB</button>
<label class="btn file" title="Ch·ªçn file .txt, .pdf, .docx ƒë·ªÉ ingest">
            Ch·ªçn file...
            <input id="file-upload" type="file" multiple accept=".txt,.pdf,.docx" hidden />
          </label>
<button id="btn-upload" class="btn" title="Ingest c√°c file ƒë√£ ch·ªçn v√†o DB">Ingest file</button>
<button id="btn-reload" class="btn" title="T·∫£i l·∫°i danh s√°ch DB, t√†i li·ªáu v√† h·ªôi tho·∫°i">T·∫£i l·∫°i</button>
<button id="btn-chat-export-db-json" class="btn" title="Xu·∫•t to√†n b·ªô h·ªôi tho·∫°i c·ªßa DB th√†nh ZIP (JSON)">Export DB (ZIP)</button>
          <span id="db-status" class="status"></span>
          <span id="backend-status" class="status"></span>
        </div>
      </div>

      <div class="workspace">
        <!-- Sidebar -->
        <aside class="sidebar">
          <div class="panel">
            <div class="panel-title">T√†i li·ªáu trong DB (doc_id):</div>
            <ul id="doc-list" class="list"></ul>
            <div class="panel-actions">
              <button id="btn-docs-delete" class="btn danger">X√≥a t√†i li·ªáu ƒë√£ ch·ªçn</button>
            </div>
          </div>

          <div class="panel">
            <button id="btn-chat-new" class="btn primary full">H·ªôi tho·∫°i m·ªõi</button>
          </div>

          <div class="panel">
            <div class="panel-title">L·ªãch s·ª≠ h·ªôi tho·∫°i:</div>
            <ul id="chat-list" class="list"></ul>
          </div>

          <!-- Hidden select to keep compatibility with existing JS logic -->
          <select id="chat-select" style="display:none;"></select>
        </aside>

        <!-- Main area -->
        <main class="main">
          <div class="panel">
            <div class="panel-title">H·ªèi - ƒê√°p</div>
<div id="result" class="result" style="min-height: 160px;">Nh·∫≠p c√¢u h·ªèi r·ªìi b·∫•m G·ª≠i ƒë·ªÉ b·∫Øt ƒë·∫ßu. üí°</div>
            <div id="contexts" class="contexts"></div>
            <div id="citations" class="citations"></div>
          </div>
          <div class="query-row">
            <input id="txt-query" type="text" placeholder="Nh·∫≠p c√¢u h·ªèi... (vd: 'H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t?')" class="query-input" title="C√¢u h·ªèi ƒë·ªÉ truy v·∫•n RAG" />
            <button id="btn-ask" class="btn primary" title="G·ª≠i truy v·∫•n t·ªõi backend">G·ª≠i</button>
            <label class="opt" title="Top-K (s·ªë ng·ªØ c·∫£nh t·ªëi ƒëa)">
              K: <input id="top-k" type="number" min="1" max="50" value="5" class="control" style="width:72px" />
            </label>
            <label class="opt" title="L∆∞u c·∫∑p H·ªèi/ƒê√°p v√†o l·ªãch s·ª≠"><input id="ck-save-chat" type="checkbox" checked /> L∆∞u h·ªôi tho·∫°i</label>
            <label class="opt">Provider:
              <select id="provider-select" class="control" title="Ch·ªçn d·ªãch v·ª• sinh c√¢u tr·∫£ l·ªùi">
                <option value="ollama" selected>Ollama</option>
                <option value="openai">OpenAI</option>
              </select>
            </label>
            <label class="opt" title="Hi·ªÉn th·ªã c√¢u tr·∫£ l·ªùi theo lu·ªìng"><input id="ck-stream" type="checkbox" /> Streaming</label>
          </div>

<div class="panel">
            <div class="panel-title">T√πy ch·ªçn n√¢ng cao <button id="btn-adv-reset" class="btn" title="Kh√¥i ph·ª•c thi·∫øt l·∫≠p n√¢ng cao v·ªÅ m·∫∑c ƒë·ªãnh">M·∫∑c ƒë·ªãnh</button></div>
            <div class="adv-grid">
<label class="opt" title="Ph∆∞∆°ng ph√°p truy h·ªìi: Vector (embedding), BM25 (t·ª´ kh√≥a), Hybrid (k·∫øt h·ª£p)">
                Ph∆∞∆°ng ph√°p: <span class="hint" title="vector: ng·ªØ nghƒ©a | bm25: t·ª´ kho√° ch√≠nh x√°c | hybrid: k·∫øt h·ª£p">(?)</span>
                <select id="method" class="control">
                  <option value="vector" title="D·ª±a embedding, h·ª£p c√¢u h·ªèi ng·ªØ nghƒ©a" selected>vector (semantic)</option>
                  <option value="bm25" title="D·ª±a t·ª´ kho√°, ph√π h·ª£p truy v·∫•n ch√≠nh x√°c">bm25 (keywords)</option>
                  <option value="hybrid" title="K·∫øt h·ª£p vector+bm25, c√¢n b·∫±ng b·∫±ng BM25 weight">hybrid (mix)</option>
                </select>
              </label>
<div id="bm25-weight-wrap" title="Tr·ªçng s·ªë cho BM25 khi ch·ªçn hybrid (0..1). 0.5 = c√¢n b·∫±ng.">
                <label class="opt">BM25 weight <span class="hint" title="TƒÉng l√™n ‚Üí ∆∞u ti√™n t·ª´ kho√°; gi·∫£m xu·ªëng ‚Üí ∆∞u ti√™n ng·ªØ nghƒ©a">(?)</span>: <span id="bm25-weight-val">0.5</span></label>
                <input id="bm25-weight" type="range" min="0" max="1" step="0.05" value="0.5" class="control" style="width:220px" />
              </div>

<label class="opt" title="Reranker: s·∫Øp x·∫øp l·∫°i c√°c ng·ªØ c·∫£nh b·∫±ng m√¥ h√¨nh ranking">
                <input id="ck-rerank" type="checkbox" /> D√πng Reranker <span class="hint" title="C·∫£i thi·ªán ch·∫•t l∆∞·ª£ng ng·ªØ c·∫£nh nh∆∞ng t·ªën CPU h∆°n">(?)</span>
              </label>
<div id="rerank-topn-wrap" title="S·ªë ng·ªØ c·∫£nh ƒë·∫ßu v√†o cho reranker (Top-N)">
                <label class="opt">Rerank Top-N <span class="hint" title="TƒÉng Top-N ‚Üí reranker c√≥ nhi·ªÅu ·ª©ng vi√™n h∆°n (nh∆∞ng ch·∫≠m h∆°n)">(?)</span>:
                  <input id="rerank-topn" type="number" min="1" max="50" value="10" class="control" style="width:80px" />
                </label>
              </div>
              <div id="rerank-adv" title="Thi·∫øt l·∫≠p n√¢ng cao cho reranker">
<label class="opt">Provider <span class="hint" title="auto: t·ª± ch·ªçn | bge: reranker ONNX BGE | embed: d·ª±a ƒë·ªô t∆∞∆°ng t·ª± embedding">(?)</span>:
                  <select id="rr-provider" class="control">
                    <option value="auto" title="T·ª± ƒë·ªông ch·ªçn ph√π h·ª£p" selected>auto</option>
                    <option value="bge" title="D√πng m√¥ h√¨nh rerank BGE (ONNX)">bge</option>
                    <option value="embed" title="∆Øu ti√™n ƒëi·ªÉm t∆∞∆°ng t·ª± embedding">embed</option>
                  </select>
                </label>
                <label class="opt">Max-K:
                  <input id="rr-maxk" type="number" min="5" max="200" value="50" class="control" style="width:80px" />
                </label>
                <label class="opt">Batch:
                  <input id="rr-batch" type="number" min="1" max="64" value="16" class="control" style="width:80px" />
                </label>
                <label class="opt">Threads:
                  <input id="rr-threads" type="number" min="1" max="16" value="1" class="control" style="width:80px" />
                </label>
              </div>

<label class="opt" title="Rewrite: sinh bi·∫øn th·ªÉ truy v·∫•n, h·ª£p nh·∫•t RRF tr∆∞·ªõc khi rerank/sinh tr·∫£ l·ªùi">
                <input id="ck-rewrite" type="checkbox" /> Rewrite truy v·∫•n <span class="hint" title="H·ªØu √≠ch khi c√¢u h·ªèi ng·∫Øn/kh√≥; khuy·∫øn ngh·ªã n=2-3">(?)</span>
              </label>
<div id="rewrite-n-wrap" title="S·ªë bi·∫øn th·ªÉ truy v·∫•n ƒë·ªÉ sinh (n)">
                <label class="opt">n <span class="hint" title="2-3: c√¢n b·∫±ng ch·∫•t l∆∞·ª£ng/hi·ªáu nƒÉng">(?)</span>:
                  <input id="rewrite-n" type="number" min="1" max="5" value="2" class="control" style="width:72px" />
                </label>
              </div>

<label class="opt" title="Multi-hop: ph√¢n r√£ c√¢u h·ªèi th√†nh nhi·ªÅu b∆∞·ªõc truy h·ªìi">
                <input id="ck-multihop" type="checkbox" /> Multi-hop <span class="hint" title="H·ªØu √≠ch cho c√¢u h·ªèi ph·ª©c t·∫°p; c√≥ th·ªÉ ch·∫≠m h∆°n">(?)</span>
              </label>
<div id="multihop-depth-wrap" title="S·ªë b∆∞·ªõc (Depth)">
                <label class="opt">Depth <span class="hint" title="TƒÉng Depth ƒë·ªÉ ƒëi s√¢u h∆°n; 2 l√† m·∫∑c ƒë·ªãnh h·ª£p l√Ω">(?)</span>:
                  <input id="hop-depth" type="number" min="1" max="5" value="2" class="control" style="width:72px" />
                </label>
              </div>
<div id="multihop-fanout-wrap" title="S·ªë nh√°nh m·ªói b∆∞·ªõc (Fanout)">
                <label class="opt">Fanout <span class="hint" title="S·ªë nh√°nh expand m·ªói hop; 2 l√† c√¢n b·∫±ng">(?)</span>:
                  <input id="hop-fanout" type="number" min="1" max="5" value="2" class="control" style="width:72px" />
                </label>
              </div>
<div id="multihop-fanout1-wrap" title="Fanout ri√™ng cho hop ƒë·∫ßu">
                <label class="opt">Fanout-1st <span class="hint" title="Gi·ªõi h·∫°n m·ªü r·ªông ·ªü hop ƒë·∫ßu ƒë·ªÉ gi·∫£m nhi·ªÖu">(?)</span>:
                  <input id="hop-fanout1" type="number" min="1" max="5" value="1" class="control" style="width:72px" />
                </label>
              </div>
<div id="multihop-budget-wrap" title="Ng√¢n s√°ch th·ªùi gian (ms) cho to√†n b·ªô multi-hop">
                <label class="opt">Budget (ms) <span class="hint" title="Gi·ªõi h·∫°n th·ªùi gian cho to√†n b·ªô multi-hop; 0 = kh√¥ng gi·ªõi h·∫°n">(?)</span>:
                  <input id="hop-budget" type="number" min="0" max="10000" value="0" class="control" style="width:92px" />
                </label>
              </div>
            </div>
          </div>

          <footer class="footer">
            <small>Provider: <code id="provider-name">ollama</code> | Model: <code id="model-name">llama3.1:8b</code> | Embed: <code id="embed-name">nomic-embed-text</code></small>
          </footer>
        </main>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-overlay" class="overlay" hidden></div>
    <div id="settings-modal" class="modal" hidden>
      <div class="modal-header">
        <div class="modal-title">C√†i ƒë·∫∑t</div>
        <button id="settings-close" class="btn">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <label>Provider m·∫∑c ƒë·ªãnh</label>
          <select id="settings-provider" class="control">
            <option value="ollama">Ollama</option>
            <option value="openai">OpenAI</option>
          </select>
        </div>
        <div class="form-row">
          <label><input type="checkbox" id="settings-stream-default" /> Streaming m·∫∑c ƒë·ªãnh</label>
        </div>
        <div class="form-row">
          <label>Ng√¥n ng·ªØ ∆∞u ti√™n (ƒë·ªÉ l·ªçc s·∫µn)</label>
          <input id="settings-langs" class="control" placeholder="vd: vi,en" />
        </div>
      </div>
      <div class="modal-footer">
        <button id="settings-reset-ui" class="btn danger" title="X√≥a l∆∞u tr·∫°ng th√°i UI v√† kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh">Kh√¥i ph·ª•c UI</button>
        <button id="settings-save" class="btn primary">L∆∞u</button>
      </div>
    </div>

    <!-- Quick Start Overlay -->
    <div id="quickstart-overlay" class="overlay" hidden></div>
    <div id="quickstart-modal" class="modal" hidden>
      <div class="modal-header">
        <div class="modal-title">B·∫Øt ƒë·∫ßu nhanh</div>
        <button id="quickstart-close" class="btn">‚úï</button>
      </div>
      <div class="modal-body">
        <ol>
          <li><strong>Ch·∫°y Ollama</strong>: m·ªü PowerShell v√† ch·∫°y <code>ollama serve</code></li>
          <li><strong>T·∫£i models</strong>:
            <div><code>ollama pull nomic-embed-text</code></div>
            <div><code>ollama pull llama3.1:8b</code></div>
          </li>
          <li><strong>Ingest &amp; H·ªèi</strong>:
            <div>- Th√™m t√†i li·ªáu: nh·∫≠p ƒë∆∞·ªùng d·∫´n/URL (vd: <code>data/docs/*.txt</code>) ho·∫∑c ch·ªçn file v√† b·∫•m ‚ÄúIngest file‚Äù.</div>
            <div>- Nh·∫≠p c√¢u h·ªèi v√† b·∫•m ‚ÄúG·ª≠i‚Äù. (Ph√≠m t·∫Øt: Enter g·ª≠i, Ctrl+Enter b·∫≠t/t·∫Øt Streaming)</div>
          </li>
        </ol>
        <p class="muted">M·∫πo: N·∫øu d√πng OpenAI, ƒë·ªïi Provider trong C√†i ƒë·∫∑t v√† c√†i <code>OPENAI_API_KEY</code>.</p>
      </div>
      <div class="modal-footer">
        <button id="quickstart-ok" class="btn primary">OK</button>
      </div>
    </div>

    <div id="toasts" class="toasts" aria-live="polite" aria-atomic="true"></div>
    <script src="/static/app.js?v=20250926-01"></script>
  </body>
</html>
