<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ollama RAG App</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="ui-root">
      <div class="menubar">
        <span class="menu-item" id="menu-file">File</span>
        <span class="menu-item" id="menu-settings">Cài đặt</span>
        <span class="menu-item" id="menu-help">Hỗ trợ</span>
      </div>
      <!-- Top action bar -->
      <div class="topbar">
        <div class="left">
          <span class="label">Vector DB:</span>
          <select id="db-select" class="control"></select>
          <input id="db-new-name" class="control" type="text" placeholder="Tên DB mới" />
          <button id="btn-db-create" class="btn">DB mới</button>
          <button id="btn-db-delete" class="btn danger">Xóa DB</button>
        </div>
        <div class="right">
          <input id="ingest-paths" class="control wide" type="text" placeholder="Đường dẫn hoặc URL (ví dụ data/docs/*.txt)" />
          <button id="btn-ingest-paths" class="btn">Thêm vào DB</button>
          <label class="btn file">
            Chọn file...
            <input id="file-upload" type="file" multiple accept=".txt,.pdf,.docx" hidden />
          </label>
          <button id="btn-upload" class="btn">Ingest file</button>
          <button id="btn-reload" class="btn">Tải lại</button>
          <button id="btn-chat-export-db-json" class="btn">Export DB...</button>
          <span id="db-status" class="status"></span>
        </div>
      </div>

      <div class="workspace">
        <!-- Sidebar -->
        <aside class="sidebar">
          <div class="panel">
            <div class="panel-title">Tài liệu trong DB (doc_id):</div>
            <ul id="doc-list" class="list"></ul>
            <div class="panel-actions">
              <button id="btn-docs-delete" class="btn danger">Xóa tài liệu đã chọn</button>
            </div>
          </div>

          <div class="panel">
            <button id="btn-chat-new" class="btn primary full">Hội thoại mới</button>
          </div>

          <div class="panel">
            <div class="panel-title">Lịch sử hội thoại:</div>
            <ul id="chat-list" class="list"></ul>
          </div>

          <!-- Hidden select to keep compatibility with existing JS logic -->
          <select id="chat-select" style="display:none;"></select>
        </aside>

        <!-- Main area -->
        <main class="main">
          <div class="panel">
            <div class="panel-title">Hỏi - Đáp</div>
            <div id="result" class="result" style="min-height: 160px;"></div>
            <div id="contexts" class="contexts"></div>
            <div id="citations" class="citations"></div>
          </div>
          <div class="query-row">
            <input id="txt-query" type="text" placeholder="Nhập câu hỏi..." class="query-input" />
            <button id="btn-ask" class="btn primary">Gửi</button>
            <label class="opt"><input id="ck-save-chat" type="checkbox" checked /> Lưu hội thoại</label>
            <label class="opt">Provider:
              <select id="provider-select" class="control">
                <option value="ollama" selected>Ollama</option>
                <option value="openai">OpenAI</option>
              </select>
            </label>
            <label class="opt"><input id="ck-stream" type="checkbox" /> Streaming</label>
          </div>
          <footer class="footer">
            <small>Provider: <code id="provider-name">ollama</code> | Model: <code id="model-name">llama3.1:8b</code> | Embed: <code id="embed-name">nomic-embed-text</code></small>
          </footer>
        </main>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-overlay" class="overlay" hidden></div>
    <div id="settings-modal" class="modal" hidden>
      <div class="modal-header">
        <div class="modal-title">Cài đặt</div>
        <button id="settings-close" class="btn">✕</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <label>Provider mặc định</label>
          <select id="settings-provider" class="control">
            <option value="ollama">Ollama</option>
            <option value="openai">OpenAI</option>
          </select>
        </div>
        <div class="form-row">
          <label><input type="checkbox" id="settings-stream-default" /> Streaming mặc định</label>
        </div>
        <div class="form-row">
          <label>Ngôn ngữ ưu tiên (để lọc sẵn)</label>
          <input id="settings-langs" class="control" placeholder="vd: vi,en" />
        </div>
      </div>
      <div class="modal-footer">
        <button id="settings-save" class="btn primary">Lưu</button>
      </div>
    </div>

    <script src="/static/app.js"></script>
  </body>
</html>
